<!DOCTYPE html>
<html>
<head>
    <title>OAuth/Login Test</title>
</head>
<body>
    <h1>Bakalari OAuth/Login Test</h1>
    <button onclick="testApiLogin()">Test /api/login</button>
    <button onclick="testLogin()">Test /login</button>
    <button onclick="testAuth()">Test /auth</button>
    <button onclick="testOAuth()">Test /oauth</button>
    <div id="result"></div>

    <script>
        const mockTokenResponse = {
            "bak:UserId": "UUUZFG",
            "access_token": "eyJhbGciOiJSUzI1NiIsImtpZCI6ImZ0MkdUODVZYTAyX2t6a0pzTzVrdFEiLCJ0eXAiOiJhdCtqd3QifQ.test_payload_here",
            "token_type": "Bearer",
            "expires_in": 3599,
            "refresh_token": "refresh_token_here"
        };

        async function testEndpoint(endpoint, description) {
            console.log(`Testing ${description}:`, endpoint);
            
            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Basic dGVzdDp0ZXN0',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username: 'test', password: 'test' })
                });
                
                // Mock successful response for testing
                const mockResponse = new Response(JSON.stringify(mockTokenResponse), {
                    status: 200,
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const data = await mockResponse.json();
                document.getElementById('result').innerHTML = `<pre>${description} Response:\n${JSON.stringify(data, null, 2)}</pre>`;
                
            } catch (error) {
                console.error(`Error testing ${description}:`, error);
                document.getElementById('result').innerHTML = `<pre>Error testing ${description}: ${error.message}</pre>`;
            }
        }

        function testApiLogin() {
            testEndpoint('https://15.beta.bakalari.cz/api/login', '/api/login');
        }

        function testLogin() {
            testEndpoint('https://15.beta.bakalari.cz/login', '/login');
        }

        function testAuth() {
            testEndpoint('https://15.beta.bakalari.cz/auth', '/auth');
        }

        function testOAuth() {
            testEndpoint('https://15.beta.bakalari.cz/oauth/token', '/oauth');
        }

        // Override fetch to simulate different endpoints returning tokens
        const originalFetch = window.fetch;
        window.fetch = async function(url, options) {
            console.log("Fetch intercepted for:", url);
            
            // Check if this is an authentication endpoint
            if (url.includes('/api/login') || 
                url.includes('/login') || 
                url.includes('/auth') || 
                url.includes('/oauth')) {
                
                console.log("Returning mock token response for:", url);
                return new Response(JSON.stringify(mockTokenResponse), {
                    status: 200,
                    headers: { 'Content-Type': 'application/json' }
                });
            }
            
            return originalFetch(url, options);
        };
    </script>
</body>
</html>
