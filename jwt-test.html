<!DOCTYPE html>
<html>
<head>
    <title>JWT Test</title>
</head>
<body>
    <h1>JWT Decoder Test</h1>
    <textarea id="jwtInput" placeholder="Paste JWT token here" rows="5" cols="80"></textarea><br><br>
    <button onclick="testDecode()">Test Decode</button><br><br>
    <pre id="result"></pre>

    <script>
        function decodeJwtPayload(bearer) {
          if (!bearer) return null;
          
          console.log("Decoding bearer token:", bearer);
          
          // Extract token from Bearer header
          const m = bearer.match(/^Bearer\s+(.+)$/i);
          const token = m ? m[1] : bearer;
          
          console.log("Extracted token:", token);
          
          // Split JWT into parts
          const parts = token.split(".");
          console.log("JWT parts count:", parts.length);
          
          if (parts.length !== 3) {
            return { 
              error: "Invalid JWT format", 
              debug: `Expected 3 parts, got ${parts.length}`,
              token: token.substring(0, 50) + "..." 
            };
          }
          
          try {
            // Decode the payload (second part)
            const payload = parts[1];
            console.log("Raw payload part:", payload);
            
            // Fix base64url encoding
            const base64 = payload.replace(/-/g, '+').replace(/_/g, '/');
            const pad = base64.length % 4 ? '='.repeat(4 - (base64.length % 4)) : '';
            const paddedBase64 = base64 + pad;
            
            console.log("Base64 with padding:", paddedBase64);
            
            const json = atob(paddedBase64);
            console.log("Decoded JSON string:", json);
            
            const parsed = JSON.parse(json);
            console.log("Parsed JWT payload:", parsed);
            
            return parsed;
          } catch (e) {
            console.error("JWT decode error:", e);
            return { 
              error: "Cannot decode JWT", 
              details: e.message,
              token: token.substring(0, 50) + "..."
            };
          }
        }

        function testDecode() {
            const input = document.getElementById('jwtInput').value.trim();
            const result = decodeJwtPayload(input);
            document.getElementById('result').textContent = JSON.stringify(result, null, 2);
        }

        // Test with a sample JWT
        document.getElementById('jwtInput').value = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c';
    </script>
</body>
</html>
